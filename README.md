# oshinko-rest
REST api for a spark cluster management app

## Development notes

This project is using an OpenAPI definition for its API, located at
`api/swagger.yaml`. The code in this project has been mostly generated by
using the tooling from (go-swagger)[https://github.com/go-swagger/go-swagger].

Due to the generated nature of this codebase, there are a few places to
investigate when looking to add functionality:

* `restapi/configure_oshinko_rest.go`, this file is generated by the go-swagger
  tooling, but is deemed safe to edit as the entry point for endpoint handlers.

* `handlers/*`, this package has been added to help separate the endpoint
  handler functions. New handlers, or handler functionality, should be added
  here.

### Requirements for building

* godep, https://github.com/tools/godep
* go-swagger, https://github.com/go-swagger/go-swagger (only needed for
  validating the api file)

### Running as a Docker container

To run the rest server as a container, use the `make image` target to build a
container image. With the image built, it can be started from the command
line using a syntax similar to:

    $ docker run --rm -it -p 8080:8080 oshinko-rest-server

This will start the server listening on `0.0.0.0:8080`, which is the default
option. To customize this behavior, the environment variables
`OSHINKO_SERVER_HOST` and `OSHINKO_SERVER_PORT` can be specified to the
`docker run` command to specify an address and port, respectively.

### Debugging with delve

Delve can be found at https://github.com/derekparker/delve with
instructions for building/installing.

Assuming that delve is installed on your local system and you have
the oshinko-rest source code checkout out, here is a simple overview
of how to get going with delve to debug oshinko-rest.

Delve can handle vendoring but you must set the flag in the env:

    $ export GO15VENDOREXPERIMENT=1

Set your GOPATH appropriately and navigate to the directory
containing the *main.go* file for oshinko-rest, for example:

    $ export GOPATH=/home/oshinko-rest
    $ cd /home/oshinko-rest/src/github.com/redhatanalytics/oshinko-rest/cmd/oshinko-rest-server
    $ ls
    main.go


Simply invoke delve in the directory to start debugging:

    $ dlv debug
    Type 'help' for list of commands.
    (dlv) continue
    2016/07/12 14:45:50 Serving oshinko rest at http://127.0.0.1:38016

To pass arguments to oshinko-rest, the invocation will look something like:

    $ dlv debug -- --port=32344

Breakpoints can be set by file:line or by package.function, as long as it
is unambiguous. For example:

    (dlv) break  /home/oshinko-rest/src/github.com/redhatanalytics/oshinko-rest/handlers/server.go:12
    Breakpoint 1 set at 0x5f3ebc for github.com/redhatanalytics/oshinko-rest/handlers.ServerResponse() /home/oshinko-rest/src/github.com/redhatanalytics/oshinko-rest/handlers/server.go:12

    (dlv) break main.main
    Breakpoint 1 set at 0x4020eb for main.main() ./main.go:17

That's it! Use **help** for commands like (c)ontinue, (s)tep, (n)ext, etc
